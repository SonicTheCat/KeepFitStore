@using KeepFitStore.Models.ViewModels.Orders
@using KeepFitStore.Domain.Enums
@using Microsoft.Extensions.Options
@inject IOptions<KeepFitStore.Helpers.StripeSettings> Stripe

@model CompleteOrderViewModel
@{
    ViewData["Title"] = "Complete Order";
}

<h1 class="text-center text-secondary p-1 mt-3 mb-2">Thank you for choosing our services!</h1>
<h5 class="text-center p-1 mb-2">Here's a brief information about your order.</h5>

<h6 class="mt-3 mb-0">Expected: @Model.DeliveryDate.Value.ToString("dd/MM/yyyy")</h6>
<h6 class="mt-0 mb-0">Total:  &pound;@Model.TotalPrice</h6>

@if (Model.PaymentType == PaymentType.Card)
{
<h6 class="mb-3">Go to <a href="#my-pay-form"><strong>Pay With Card </strong></a>options</h6>
}
<ul class="list-group mb-3">
    @foreach (var item in Model.Products)
    {
        <li class="list-group-item mt-4 shadow flex-lg-row flex-md-row flex-sm-row flex-column d-flex justify-content-between align-items-center">

            <img src="@item.ProductImageUrl" width="100" height="100" alt="Alternate Text" />
            <div class="col-xl-2 col-md-4 col-lg-3 col-sm-6 mb-4 pt-4">
                @item.ProductName
            </div>
            <div class="col-xl-2 col-md-4 col-lg-3 col-sm-6 mb-4 pt-4">
                &pound;@item.ProductPrice
            </div>
            <div class="col-xl-2 col-md-4 col-lg-3 col-sm-6 mb-4 pt-4">
                Qty: @item.Quantity
            </div>
        </li>
    }
</ul>

@if (Model.PaymentType == PaymentType.Card)
{
    <div id="my-pay-form" class="text-center">
        <form asp-controller="Payment" asp-action="Charge" asp-route-amount="@Model.TotalPrice" asp-route-orderId="@Model.Id" method="POST">
            <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
                    data-key="@Stripe.Value.PublishableKey"
                    data-locale="auto"
                    data-name="@Model.KeepFitUserFullName"
                    data-description="Keep Fit Store Supliments"
                    data-label="Pay with Card &pound;@Model.TotalPrice">
            </script>
        </form>
    </div>
}
else
{
    <div class="text-center">
        <a asp-controller="Orders" asp-action="Index" class="btn btn-warning">Go To My Orders</a>
    </div> 
}